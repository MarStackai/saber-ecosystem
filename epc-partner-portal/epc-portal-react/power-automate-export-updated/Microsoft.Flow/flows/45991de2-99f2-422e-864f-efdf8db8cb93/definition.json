{
  "name": "a795ca0b-3293-4ae7-8f80-5e00148594cd",
  "id": "/providers/Microsoft.Flow/flows/a795ca0b-3293-4ae7-8f80-5e00148594cd",
  "type": "Microsoft.Flow/flows",
  "properties": {
    "apiId": "/providers/Microsoft.PowerApps/apis/shared_logicflows",
    "displayName": "EPC Application Submission Processor",
    "definition": {
      "metadata": {
        "workflowEntityId": null,
        "processAdvisorMetadata": null,
        "flowChargedByPaygo": null,
        "flowclientsuspensionreason": "None",
        "flowclientsuspensiontime": null,
        "flowclientsuspensionreasondetails": null,
        "creator": {
          "id": "e82d7ff1-337a-4e63-a34c-9de13137248c",
          "type": "User",
          "tenantId": "dd0eeaf2-2c36-4709-9554-6e2b2639c3d1"
        },
        "provisioningMethod": "FromDefinition",
        "failureAlertSubscription": true,
        "clientLastModifiedTime": "2025-09-10T11:35:56.652252Z",
        "connectionKeySavedTimeKey": "2025-09-10T11:35:56.652252Z",
        "creationSource": "Portal",
        "modifiedSources": "Portal"
      },
      "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
      "contentVersion": "undefined",
      "parameters": {
        "$authentication": {
          "defaultValue": {},
          "type": "SecureObject"
        },
        "$connections": {
          "defaultValue": {},
          "type": "Object"
        }
      },
      "triggers": {
        "manual": {
          "metadata": {},
          "type": "Request",
          "kind": "Http",
          "inputs": {
            "schema": {
              "type": "object",
              "properties": {
                "invitationCode": {
                  "type": "string"
                },
                "companyName": {
                  "type": "string"
                },
                "registrationNumber": {
                  "type": "string"
                },
                "contactName": {
                  "type": "string"
                },
                "contactTitle": {
                  "type": "string"
                },
                "email": {
                  "type": "string"
                },
                "phone": {
                  "type": "string"
                },
                "address": {
                  "type": "string"
                },
                "services": {
                  "type": "array"
                },
                "yearsExperience": {
                  "type": "number"
                },
                "teamSize": {
                  "type": "number"
                },
                "coverage": {
                  "type": "string"
                },
                "timestamp": {
                  "type": "string"
                },
                "source": {
                  "type": "string"
                },
                "servicesExperience": {
                  "type": "object",
                  "properties": {
                    "servicesProvided": {
                      "type": "array"
                    },
                    "averageProjectsPerMonth": {
                      "type": "number"
                    },
                    "softwareTools": {
                      "type": "string"
                    },
                    "specializations": {
                      "type": "string"
                    }
                  }
                },
                "projectReferences": {
                  "type": "object",
                  "properties": {
                    "regionsCovered": {
                      "type": "array"
                    },
                    "nationwideCoverage": {
                      "type": "boolean"
                    },
                    "clientReference": {
                      "type": "string"
                    }
                  }
                },
                "referenceNumber": {
                  "type": "string"
                },
                "healthSafety": {
                  "type": "object",
                  "properties": {
                    "hsCdmEvidence": {
                      "type": "string"
                    },
                    "qualityEvidence": {
                      "type": "string"
                    },
                    "nearMissProcedure": {
                      "type": "string"
                    },
                    "riddorDetails": {
                      "type": "string"
                    },
                    "namedPrincipalDesigner": {
                      "type": "string"
                    },
                    "hseNotices": {
                      "type": "string"
                    },
                    "pdQualifications": {
                      "type": "string"
                    },
                    "trainingRecords": {
                      "type": "string"
                    },
                    "riddorCount": {
                      "type": "number"
                    }
                  }
                },
                "companyInfo": {
                  "type": "object",
                  "properties": {
                    "registrationNumber": {
                      "type": "string"
                    },
                    "companyName": {
                      "type": "string"
                    },
                    "parentCompany": {
                      "type": "string"
                    },
                    "headOfficeAddress": {
                      "type": "string"
                    },
                    "tradingName": {
                      "type": "string"
                    },
                    "registeredAddress": {
                      "type": "string"
                    },
                    "vatNumber": {
                      "type": "string"
                    },
                    "yearsTrading": {
                      "type": "number"
                    }
                  }
                },
                "legalCompliance": {
                  "type": "object",
                  "properties": {
                    "legalClarifications": {
                      "type": "string"
                    },
                    "pendingProsecutions": {
                      "type": "string"
                    },
                    "contractsReviewed": {
                      "type": "boolean"
                    }
                  }
                },
                "policies": {
                  "type": "object",
                  "properties": {
                    "msPolicyDate": {
                      "type": "string"
                    },
                    "hsPolicyDate": {
                      "type": "string"
                    },
                    "envPolicyDate": {
                      "type": "string"
                    },
                    "rightToWorkMethod": {
                      "type": "string"
                    },
                    "mosPolicyDate": {
                      "type": "string"
                    }
                  }
                },
                "dataProtectionIT": {
                  "type": "object",
                  "properties": {
                    "cyberIncident": {
                      "type": "string"
                    },
                    "gdprPolicyDate": {
                      "type": "string"
                    }
                  }
                },
                "primaryContact": {
                  "type": "object",
                  "properties": {
                    "fullName": {
                      "type": "string"
                    },
                    "jobTitle": {
                      "type": "string"
                    },
                    "email": {
                      "type": "string"
                    },
                    "phone": {
                      "type": "string"
                    }
                  }
                },
                "insurance": {
                  "type": "object",
                  "properties": {
                    "publicLiabilityInsurance": {
                      "type": "boolean"
                    },
                    "employersLiabilityInsurance": {
                      "type": "boolean"
                    },
                    "pplIndemnityClause": {
                      "type": "boolean"
                    },
                    "piExpiryDate": {
                      "type": "string"
                    },
                    "professionalIndemnityInsurance": {
                      "type": "boolean"
                    },
                    "pplExpiryDate": {
                      "type": "string"
                    },
                    "elExpiryDate": {
                      "type": "string"
                    }
                  }
                },
                "agreement": {
                  "type": "object",
                  "properties": {
                    "dataProcessingConsent": {
                      "type": "boolean"
                    },
                    "marketingConsent": {
                      "type": "boolean"
                    },
                    "agreeToTerms": {
                      "type": "boolean"
                    },
                    "agreeToCodes": {
                      "type": "boolean"
                    },
                    "receivedContractPack": {
                      "type": "boolean"
                    }
                  }
                },
                "deliveryCapability": {
                  "type": "object",
                  "properties": {
                    "resourcingApproach": {
                      "type": "string"
                    }
                  }
                },
                "certifications": {
                  "type": "object",
                  "properties": {
                    "isoCertifications": {
                      "type": "array"
                    },
                    "niceicContractor": {
                      "type": "boolean"
                    },
                    "mcsApproved": {
                      "type": "boolean"
                    },
                    "constructionSchemes": {
                      "type": "array"
                    }
                  }
                },
                "rolesCapabilities": {
                  "type": "object",
                  "properties": {
                    "pcScaleLastYear": {
                      "type": "string"
                    },
                    "pdScaleLastYear": {
                      "type": "string"
                    },
                    "internalStaffPercentage": {
                      "type": "number"
                    },
                    "subcontractPercentage": {
                      "type": "number"
                    },
                    "principalDesigner": {
                      "type": "boolean"
                    },
                    "principalContractor": {
                      "type": "boolean"
                    }
                  }
                },
                "submission": {
                  "type": "object",
                  "properties": {
                    "additionalInformation": {
                      "type": "string"
                    }
                  }
                }
              }
            },
            "triggerAuthenticationType": "All"
          }
        }
      },
      "actions": {
        "Get_items": {
          "runAfter": {},
          "type": "OpenApiConnection",
          "inputs": {
            "parameters": {
              "dataset": "https://saberrenewables.sharepoint.com/sites/SaberEPCPartners",
              "table": "ae795135-d308-40d0-a2f2-90d66dbf7e2c",
              "$filter": "Code eq '@{triggerBody()?['invitationCode']}'"
            },
            "host": {
              "apiId": "/providers/Microsoft.PowerApps/apis/shared_sharepointonline",
              "connectionName": "shared_sharepointonline",
              "operationId": "GetItems"
            },
            "authentication": "@parameters('$authentication')"
          }
        },
        "Condition": {
          "actions": {
            "Create_item": {
              "type": "OpenApiConnection",
              "inputs": {
                "parameters": {
                  "dataset": "https://saberrenewables.sharepoint.com/sites/SaberEPCPartners",
                  "table": "67c6199a-fdfc-4c17-a8e5-3914130cfabd",
                  "item/Title": "@triggerBody()?['companyName']",
                  "item/CompanyName": "@triggerBody()?['companyName']",
                  "item/RegistrationNumber": "@triggerBody()?['registrationNumber']",
                  "item/ContactName": "@triggerBody()?['contactName']",
                  "item/ContactTitle": "@triggerBody()?['contactTitle']",
                  "item/Email": "@triggerBody()?['email']",
                  "item/Phone": "@triggerBody()?['phone']",
                  "item/Address": "@triggerBody()?['address']",
                  "item/YearsExperience": "@triggerBody()?['yearsExperience']",
                  "item/TeamSize": "@triggerBody()?['teamSize']",
                  "item/Coverage": "@triggerBody()?['coverage']",
                  "item/InvitationCode": "@triggerBody()?['invitationCode']",
                  "item/SubmissionDate": "@triggerBody()?['timestamp']",
                  "item/Status/Value": "New",
                  "item/SubmissionHandled": false,
                  "item/TradingName": "@triggerBody()?['companyInfo']?['tradingName']",
                  "item/RegisteredOffice": "@coalesce(triggerBody()?['companyInfo']?['registeredAddress'], triggerBody()?['address'])",
                  "item/HeadOffice": "@triggerBody()?['companyInfo']?['headOfficeAddress']",
                  "item/CompanyRegNo": "@coalesce(triggerBody()?['companyInfo']?['registrationNumber'], triggerBody()?['registrationNumber'])",
                  "item/VATNumber": "@triggerBody()?['companyInfo']?['vatNumber']",
                  "item/ParentCompany": "@triggerBody()?['companyInfo']?['parentCompany']",
                  "item/YearsTrading": "@triggerBody()?['companyInfo']?['yearsTrading']",
                  "item/PrimaryContactName": "@coalesce(triggerBody()?['primaryContact']?['fullName'], triggerBody()?['contactName'])",
                  "item/PrimaryContactTitle": "@coalesce(triggerBody()?['primaryContact']?['jobTitle'], triggerBody()?['contactTitle'])",
                  "item/PrimaryContactPhone": "@coalesce(triggerBody()?['primaryContact']?['phone'], triggerBody()?['phone'])",
                  "item/PrimaryContactEmail": "@coalesce(triggerBody()?['primaryContact']?['email'], triggerBody()?['email'])",
                  "item/Specialisations": "@triggerBody()?['servicesExperience']?['specializations']",
                  "item/SoftwareUsed": "@triggerBody()?['servicesExperience']?['softwareTools']",
                  "item/ProjectsPerMonth": "@triggerBody()?['servicesExperience']?['averageProjectsPerMonth']",
                  "item/ActsAsPrincipalContractor": "@triggerBody()?['rolesCapabilities']?['principalContractor']",
                  "item/PrincipalContractor_LastYearScale": "@triggerBody()?['rolesCapabilities']?['pcScaleLastYear']",
                  "item/ActsAsPrincipalDesigner": "@triggerBody()?['rolesCapabilities']?['principalDesigner']",
                  "item/PrincipalDesigner_LastYearScale": "@triggerBody()?['rolesCapabilities']?['pdScaleLastYear']",
                  "item/LabourMix_InternalPct": "@triggerBody()?['rolesCapabilities']?['internalStaffPercentage']",
                  "item/LabourMix_SubcontractPct": "@triggerBody()?['rolesCapabilities']?['subcontractPercentage']",
                  "item/NICEIC_CPS": "@triggerBody()?['certifications']?['niceicContractor']",
                  "item/MCS_Approved": "@triggerBody()?['certifications']?['mcsApproved']",
                  "item/PublicProductLiability_Present": "@triggerBody()?['insurance']?['publicLiabilityInsurance']",
                  "item/PublicProductLiability_IndemnityInPrinciple": "@triggerBody()?['insurance']?['pplIndemnityClause']",
                  "item/EmployersLiability_Present": "@triggerBody()?['insurance']?['employersLiabilityInsurance']",
                  "item/ProfIndemnity_Present": "@triggerBody()?['insurance']?['professionalIndemnityInsurance']",
                  "item/PublicProductLiability_Expiry": "@if(empty(triggerBody()?['insurance']?['pplExpiryDate']), null, formatDateTime(triggerBody()?['insurance']?['pplExpiryDate'], 'yyyy-MM-ddTHH:mm:ssZ'))",
                  "item/EmployersLiability_Expiry": "@if(empty(triggerBody()?['insurance']?['elExpiryDate']), null, formatDateTime(triggerBody()?['insurance']?['elExpiryDate'], 'yyyy-MM-ddTHH:mm:ssZ'))",
                  "item/ProfIndemnity_Expiry": "@if(empty(triggerBody()?['insurance']?['piExpiryDate']), null, formatDateTime(triggerBody()?['insurance']?['piExpiryDate'], 'yyyy-MM-ddTHH:mm:ssZ'))",
                  "item/HSE_ImprovementOrProhibition_Last5Y": "@triggerBody()?['healthSafety']?['hseNotices']",
                  "item/RIDDOR_Incidents_Last3Y_Count": "@triggerBody()?['healthSafety']?['riddorCount']",
                  "item/RIDDOR_Incidents_Last3Y_Details": "@triggerBody()?['healthSafety']?['riddorDetails']",
                  "item/HSE_CDM_Management_Evidence": "@triggerBody()?['healthSafety']?['hsCdmEvidence']",
                  "item/Named_PrincipalDesigner": "@triggerBody()?['healthSafety']?['namedPrincipalDesigner']",
                  "item/PD_Qualifications": "@triggerBody()?['healthSafety']?['pdQualifications']",
                  "item/TrainingRecords_Summary": "@triggerBody()?['healthSafety']?['trainingRecords']",
                  "item/NearMiss_Procedure": "@triggerBody()?['healthSafety']?['nearMissProcedure']",
                  "item/Quality_Procedure_Evidence": "@triggerBody()?['healthSafety']?['qualityEvidence']",
                  "item/Policy_HS_DateSigned": "@if(empty(triggerBody()?['policies']?['hsPolicyDate']), null, formatDateTime(triggerBody()?['policies']?['hsPolicyDate'], 'yyyy-MM-ddTHH:mm:ssZ'))",
                  "item/Policy_Env_DateSigned": "@if(empty(triggerBody()?['policies']?['envPolicyDate']), null, formatDateTime(triggerBody()?['policies']?['envPolicyDate'], 'yyyy-MM-ddTHH:mm:ssZ'))",
                  "item/Policy_MS_DateSigned": "@if(empty(triggerBody()?['policies']?['msPolicyDate']), null, formatDateTime(triggerBody()?['policies']?['msPolicyDate'], 'yyyy-MM-ddTHH:mm:ssZ'))",
                  "item/Policy_MOS_DateSigned": "@if(empty(triggerBody()?['policies']?['mosPolicyDate']), null, formatDateTime(triggerBody()?['policies']?['mosPolicyDate'], 'yyyy-MM-ddTHH:mm:ssZ'))",
                  "item/RightToWork_Monitoring_Method": "@triggerBody()?['policies']?['rightToWorkMethod']",
                  "item/GDPRPolicy_DateSigned": "@if(empty(triggerBody()?['dataProtectionIT']?['gdprPolicyDate']), null, formatDateTime(triggerBody()?['dataProtectionIT']?['gdprPolicyDate'], 'yyyy-MM-ddTHH:mm:ssZ'))",
                  "item/CyberIncident_Last3Y": "@triggerBody()?['dataProtectionIT']?['cyberIncident']",
                  "item/Resources_PerProject": "@triggerBody()?['deliveryCapability']?['resourcingApproach']",
                  "item/Coverage_Nationwide": "@triggerBody()?['projectReferences']?['nationwideCoverage']",
                  "item/Client_Reference": "@triggerBody()?['projectReferences']?['clientReference']",
                  "item/PendingProsecutions_Details": "@triggerBody()?['legalCompliance']?['pendingProsecutions']",
                  "item/Contracts_ReviewedBySignatory": "@triggerBody()?['legalCompliance']?['contractsReviewed']",
                  "item/Legal_Clarifications": "@triggerBody()?['legalCompliance']?['legalClarifications']",
                  "item/Received_ContractOverviewPack": "@triggerBody()?['agreement']?['receivedContractPack']",
                  "item/Willing_To_WorkToSaberTerms": "@triggerBody()?['agreement']?['agreeToTerms']",
                  "item/AgreeToCodes": "@triggerBody()?['agreement']?['agreeToCodes']",
                  "item/DataProcessingConsent": "@triggerBody()?['agreement']?['dataProcessingConsent']",
                  "item/MarketingConsent": "@triggerBody()?['agreement']?['marketingConsent']",
                  "item/AdditionalInfo": "@triggerBody()?['submission']?['additionalInformation']",
                  "item/ReferenceNumber": "@coalesce(triggerBody()?['referenceNumber'], concat('EPC-', utcNow('yyyyMMddHHmmss')))",
                  "item/SubmissionStatus": "Submitted"
                },
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_sharepointonline",
                  "connectionName": "shared_sharepointonline",
                  "operationId": "PostItem"
                },
                "authentication": "@parameters('$authentication')"
              }
            },
            "Update_item": {
              "runAfter": {
                "Create_item": [
                  "Succeeded"
                ]
              },
              "type": "OpenApiConnection",
              "inputs": {
                "parameters": {
                  "dataset": "https://saberrenewables.sharepoint.com/sites/SaberEPCPartners",
                  "table": "ae795135-d308-40d0-a2f2-90d66dbf7e2c",
                  "id": "@first(body('Get_items')?['value'])?['ID']",
                  "item/Title": "@first(body('Get_items')?['value'])?['Title']",
                  "item/CompanyName": "@triggerBody()?['companyName']",
                  "item/ContactEmail": "@triggerBody()?['email']",
                  "item/Code": "@triggerBody()?['invitationCode']",
                  "item/InvitationSent": false,
                  "item/Used": true,
                  "item/UsedBy": "@triggerBody()?['email']",
                  "item/UsedDate": "@utcNow()"
                },
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_sharepointonline",
                  "connectionName": "shared_sharepointonline",
                  "operationId": "PatchItem"
                },
                "authentication": "@parameters('$authentication')"
              }
            },
            "Response": {
              "runAfter": {
                "Update_item": [
                  "Succeeded"
                ]
              },
              "type": "Response",
              "kind": "Http",
              "inputs": {
                "statusCode": 200,
                "body": {
                  "success": true,
                  "message": "Application submitted successfully",
                  "referenceNumber": "@{body('Create_item')?['ID']}"
                }
              }
            },
            "Send_an_email_(V2)": {
              "runAfter": {
                "Send_an_email_(V2)_1": [
                  "Succeeded"
                ]
              },
              "type": "OpenApiConnection",
              "inputs": {
                "parameters": {
                  "emailMessage/To": "SysAdmin@saberrenewables.com;Jess@saberrenewables.com;Rob@saberrenewables.com;gerry@saberrenewables.com",
                  "emailMessage/Subject": "New EPC Application - @{coalesce(triggerBody()?['companyInfo']?['companyName'], triggerBody()?['companyName'])}",
                  "emailMessage/Body": "<h2>New EPC Application Received</h2>\n<table border=\"1\" style=\"border-collapse: collapse; width: 100%;\">\n<tbody>\n<tr><td><strong>Company</strong></td><td>@{coalesce(triggerBody()?['companyInfo']?['companyName'], triggerBody()?['companyName'])}</td></tr>\n<tr><td><strong>Contact</strong></td><td>@{coalesce(triggerBody()?['primaryContact']?['fullName'], triggerBody()?['contactName'])}</td></tr>\n<tr><td><strong>Email</strong></td><td>@{coalesce(triggerBody()?['primaryContact']?['email'], triggerBody()?['email'])}</td></tr>\n<tr><td><strong>Phone</strong></td><td>@{coalesce(triggerBody()?['primaryContact']?['phone'], triggerBody()?['phone'])}</td></tr>\n<tr><td><strong>Registration No</strong></td><td>@{coalesce(triggerBody()?['companyInfo']?['registrationNumber'], triggerBody()?['registrationNumber'])}</td></tr>\n<tr><td><strong>SharePoint ID</strong></td><td>@{body('Create_item')?['ID']}</td></tr>\n<tr><td><strong>Code Used</strong></td><td>@{triggerBody()?['invitationCode']}</td></tr>\n</tbody>\n</table>\n\n<h3>Extended Form Data Available</h3>\n<ul>\n<li><strong>Principal Contractor:</strong> @{triggerBody()?['rolesCapabilities']?['principalContractor']}</li>\n<li><strong>Principal Designer:</strong> @{triggerBody()?['rolesCapabilities']?['principalDesigner']}</li>\n<li><strong>ISO Certifications:</strong> @{join(triggerBody()?['certifications']?['isoCertifications'], ', ')}</li>\n<li><strong>Insurance Present:</strong> PPL: @{triggerBody()?['insurance']?['publicLiabilityInsurance']}, EL: @{triggerBody()?['insurance']?['employersLiabilityInsurance']}, PI: @{triggerBody()?['insurance']?['professionalIndemnityInsurance']}</li>\n<li><strong>Nationwide Coverage:</strong> @{triggerBody()?['projectReferences']?['nationwideCoverage']}</li>\n<li><strong>Agreement Status:</strong> Terms: @{triggerBody()?['agreement']?['agreeToTerms']}, Codes: @{triggerBody()?['agreement']?['agreeToCodes']}, GDPR: @{triggerBody()?['agreement']?['dataProcessingConsent']}</li>\n</ul>\n\n<p><a href=\"https://saberrenewables.sharepoint.com/sites/SaberEPCPartners/Lists/EPC%20Onboarding\">View in SharePoint</a></p>",
                  "emailMessage/Importance": "Normal"
                },
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365",
                  "connectionName": "shared_office365",
                  "operationId": "SendEmailV2"
                },
                "authentication": "@parameters('$authentication')"
              }
            },
            "Send_an_email_(V2)_1": {
              "runAfter": {
                "Response": [
                  "Succeeded"
                ]
              },
              "type": "OpenApiConnection",
              "inputs": {
                "parameters": {
                  "emailMessage/To": "@triggerBody()?['email']",
                  "emailMessage/Subject": "Application Received - @{coalesce(triggerBody()?['companyInfo']?['companyName'], triggerBody()?['companyName'])}",
                  "emailMessage/Body": "<h2>Thank you for your application!</h2>\n<p>Dear @{coalesce(triggerBody()?['primaryContact']?['fullName'], triggerBody()?['contactName'])},</p>\n<p>We have received your application to join the Saber Renewables EPC Partner Network.</p>\n\n<h3>Application Details:</h3>\n<ul>\n<li><strong>Company:</strong> @{coalesce(triggerBody()?['companyInfo']?['companyName'], triggerBody()?['companyName'])}</li>\n<li><strong>Reference:</strong> EPC-@{body('Create_item')?['ID']}</li>\n<li><strong>Submitted:</strong> @{utcNow()}</li>\n<li><strong>Contact:</strong> @{coalesce(triggerBody()?['primaryContact']?['fullName'], triggerBody()?['contactName'])}</li>\n<li><strong>Registration No:</strong> @{coalesce(triggerBody()?['companyInfo']?['registrationNumber'], triggerBody()?['registrationNumber'])}</li>\n</ul>\n\n<h3>What's Next?</h3>\n<p>Our technical team will review your application and supporting documentation within 5 business days. This includes:</p>\n<ul>\n<li>✅ Company registration and compliance verification</li>\n<li>✅ Certification and accreditation review</li>\n<li>✅ Insurance policy validation</li>\n<li>✅ Health & safety documentation assessment</li>\n<li>✅ Capability and experience evaluation</li>\n</ul>\n\n<p>You will receive an email confirmation once your application has been approved and you're added to our active partner network.</p>\n\n<p>If you have any questions, please contact our Partner Team at <a href=\"mailto:partners@saberrenewables.com\">partners@saberrenewables.com</a></p>\n\n<p>Kind regards,<br><br>Saber Renewables Partner Team<br><em>Infinite Power In Partnership</em></p>",
                  "emailMessage/Importance": "Normal"
                },
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365",
                  "connectionName": "shared_office365",
                  "operationId": "SendEmailV2"
                },
                "authentication": "@parameters('$authentication')"
              }
            }
          },
          "runAfter": {
            "Get_items": [
              "Succeeded"
            ]
          },
          "else": {
            "actions": {
              "Response_1": {
                "type": "Response",
                "kind": "Http",
                "inputs": {
                  "statusCode": 400,
                  "body": {
                    "success": false,
                    "message": "Invalid or expired invitation code"
                  }
                }
              }
            }
          },
          "expression": {
            "and": [
              {
                "greater": [
                  "@length(body('Get_items')?['value'])",
                  0
                ]
              }
            ]
          },
          "type": "If"
        }
      },
      "description": ""
    },
    "connectionReferences": {
      "shared_sharepointonline": {
        "connectionName": "shared-sharepointonl-038b749e-d3fc-4c29-b1a7-dcbd63e9350a",
        "source": "Embedded",
        "id": "/providers/Microsoft.PowerApps/apis/shared_sharepointonline",
        "tier": "NotSpecified",
        "apiName": "sharepointonline",
        "isProcessSimpleApiReferenceConversionAlreadyDone": false
      },
      "shared_office365": {
        "connectionName": "shared-office365-4149f3cb-f5ed-4b42-9670-07a0ec993e6b",
        "source": "Embedded",
        "id": "/providers/Microsoft.PowerApps/apis/shared_office365",
        "tier": "NotSpecified",
        "apiName": "office365",
        "isProcessSimpleApiReferenceConversionAlreadyDone": false
      }
    },
    "flowFailureAlertSubscribed": false,
    "isManaged": false
  }
}
